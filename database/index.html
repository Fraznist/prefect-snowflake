
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://PrefectHQ.github.io/prefect-snowflake/database/">
      
      <link rel="icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>Database - prefect-snowflake</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
        
          
          
          <meta name="theme-color" content="#2094f3">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CSource+Code+Pro:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"Source Code Pro"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#prefect_snowflake.database" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="prefect-snowflake" class="md-header__button md-logo" aria-label="prefect-snowflake" data-md-component="logo">
      
  <img src="../img/prefect-logo-mark-solid-white-500.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            prefect-snowflake
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Database
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/prefecthq/prefect-snowflake" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="prefect-snowflake" class="md-nav__button md-logo" aria-label="prefect-snowflake" data-md-component="logo">
      
  <img src="../img/prefect-logo-mark-solid-white-500.png" alt="logo">

    </a>
    prefect-snowflake
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/prefecthq/prefect-snowflake" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../credentials/" class="md-nav__link">
        Credentials
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Database
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Database
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prefect_snowflake.database-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector" class="md-nav__link">
    SnowflakeConnector
  </a>
  
    <nav class="md-nav" aria-label="SnowflakeConnector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.credentials" class="md-nav__link">
    credentials
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.database" class="md-nav__link">
    database
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.fetch_size" class="md-nav__link">
    fetch_size
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.poll_frequency_s" class="md-nav__link">
    poll_frequency_s
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.schema_" class="md-nav__link">
    schema_
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.warehouse" class="md-nav__link">
    warehouse
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector-methods" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav" aria-label="Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.__enter__" class="md-nav__link">
    __enter__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.__exit__" class="md-nav__link">
    __exit__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.__getstate__" class="md-nav__link">
    __getstate__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.__json_encoder__" class="md-nav__link">
    __json_encoder__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.__setstate__" class="md-nav__link">
    __setstate__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.close" class="md-nav__link">
    close()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.execute" class="md-nav__link">
    execute()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.execute_many" class="md-nav__link">
    execute_many()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.fetch_all" class="md-nav__link">
    fetch_all()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.fetch_many" class="md-nav__link">
    fetch_many()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.fetch_one" class="md-nav__link">
    fetch_one()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.get_connection" class="md-nav__link">
    get_connection()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.reset_cursors" class="md-nav__link">
    reset_cursors()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect_snowflake.database-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.snowflake_multiquery" class="md-nav__link">
    snowflake_multiquery()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.snowflake_query" class="md-nav__link">
    snowflake_query()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.snowflake_query_sync" class="md-nav__link">
    snowflake_query_sync()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prefect_snowflake.database-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector" class="md-nav__link">
    SnowflakeConnector
  </a>
  
    <nav class="md-nav" aria-label="SnowflakeConnector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.credentials" class="md-nav__link">
    credentials
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.database" class="md-nav__link">
    database
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.fetch_size" class="md-nav__link">
    fetch_size
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.poll_frequency_s" class="md-nav__link">
    poll_frequency_s
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.schema_" class="md-nav__link">
    schema_
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.warehouse" class="md-nav__link">
    warehouse
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector-methods" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav" aria-label="Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.__enter__" class="md-nav__link">
    __enter__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.__exit__" class="md-nav__link">
    __exit__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.__getstate__" class="md-nav__link">
    __getstate__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.__json_encoder__" class="md-nav__link">
    __json_encoder__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.__setstate__" class="md-nav__link">
    __setstate__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.close" class="md-nav__link">
    close()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.execute" class="md-nav__link">
    execute()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.execute_many" class="md-nav__link">
    execute_many()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.fetch_all" class="md-nav__link">
    fetch_all()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.fetch_many" class="md-nav__link">
    fetch_many()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.fetch_one" class="md-nav__link">
    fetch_one()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.get_connection" class="md-nav__link">
    get_connection()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.SnowflakeConnector.reset_cursors" class="md-nav__link">
    reset_cursors()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect_snowflake.database-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.snowflake_multiquery" class="md-nav__link">
    snowflake_multiquery()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.snowflake_query" class="md-nav__link">
    snowflake_query()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_snowflake.database.snowflake_query_sync" class="md-nav__link">
    snowflake_query_sync()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/prefecthq/prefect-snowflake/edit/main/docs/database.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<div class="doc doc-object doc-module">



<h1 id="prefect_snowflake.database" class="doc doc-heading">
        <code>prefect_snowflake.database</code>



</h1>

    <div class="doc doc-contents first">

      <p>Module for querying against Snowflake databases.</p>



  <div class="doc doc-children">







<h2 id="prefect_snowflake.database-classes">Classes</h2>

  <div class="doc doc-object doc-class">



<h3 id="prefect_snowflake.database.SnowflakeConnector" class="doc doc-heading">
        <code>
SnowflakeConnector            (<span title="prefect.blocks.abstract.DatabaseBlock">DatabaseBlock</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-model"><code>pydantic-model</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">

      <p>Block used to manage connections with Snowflake.</p>
<p>Upon instantiating, a connection is created and maintained for the life of
the object until the close method is called.</p>
<p>It is recommended to use this block as a context manager, which will automatically
close the engine and its connections when the context is exited.</p>
<p>It is also recommended that this block is loaded and consumed within a single task
or flow because if the block is passed across separate tasks and flows,
the state of the block's connection and cursor will be lost.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>credentials</code></td>
        <td></td>
        <td><p>The credentials to authenticate with Snowflake.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>database</code></td>
        <td></td>
        <td><p>The name of the default database to use.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>warehouse</code></td>
        <td></td>
        <td><p>The name of the default warehouse to use.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>schema</code></td>
        <td></td>
        <td><p>The name of the default schema to use;
this attribute is accessible through <code>SnowflakeConnector(...).schema_</code>.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>fetch_size</code></td>
        <td></td>
        <td><p>The number of rows to fetch at a time.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>poll_frequency_s</code></td>
        <td></td>
        <td><p>The number of seconds before checking query.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <p>Load stored Snowflake connector as a context manager:
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">prefect_snowflake.database</span> <span class="kn">import</span> <span class="n">SnowflakeConnector</span>

<span class="n">snowflake_connector</span> <span class="o">=</span> <span class="n">SnowflakeConnector</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;BLOCK_NAME&quot;</span><span class="p">):</span>
</code></pre></div></p>
<p>Insert data into database and fetch results.
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">prefect_snowflake.database</span> <span class="kn">import</span> <span class="n">SnowflakeConnector</span>

<span class="k">with</span> <span class="n">SnowflakeConnector</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;BLOCK_NAME&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="s2">&quot;CREATE TABLE IF NOT EXISTS customers (name varchar, address varchar);&quot;</span>
    <span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute_many</span><span class="p">(</span>
        <span class="s2">&quot;INSERT INTO customers (name, address) VALUES (</span><span class="si">%(name)s</span><span class="s2">, </span><span class="si">%(address)s</span><span class="s2">);&quot;</span><span class="p">,</span>
        <span class="n">seq_of_parameters</span><span class="o">=</span><span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Ford&quot;</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;Highway 42&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;Space&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Me&quot;</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;Myway 88&quot;</span><span class="p">},</span>
        <span class="p">],</span>
    <span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">fetch_all</span><span class="p">(</span>
        <span class="s2">&quot;SELECT * FROM customers WHERE address = </span><span class="si">%(address)s</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;Space&quot;</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</code></pre></div></p>

        <details class="quote">
          <summary>Source code in <code>prefect_snowflake/database.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">SnowflakeConnector</span><span class="p">(</span><span class="n">DatabaseBlock</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Block used to manage connections with Snowflake.</span>

<span class="sd">    Upon instantiating, a connection is created and maintained for the life of</span>
<span class="sd">    the object until the close method is called.</span>

<span class="sd">    It is recommended to use this block as a context manager, which will automatically</span>
<span class="sd">    close the engine and its connections when the context is exited.</span>

<span class="sd">    It is also recommended that this block is loaded and consumed within a single task</span>
<span class="sd">    or flow because if the block is passed across separate tasks and flows,</span>
<span class="sd">    the state of the block&#39;s connection and cursor will be lost.</span>

<span class="sd">    Args:</span>
<span class="sd">        credentials: The credentials to authenticate with Snowflake.</span>
<span class="sd">        database: The name of the default database to use.</span>
<span class="sd">        warehouse: The name of the default warehouse to use.</span>
<span class="sd">        schema: The name of the default schema to use;</span>
<span class="sd">            this attribute is accessible through `SnowflakeConnector(...).schema_`.</span>
<span class="sd">        fetch_size: The number of rows to fetch at a time.</span>
<span class="sd">        poll_frequency_s: The number of seconds before checking query.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Load stored Snowflake connector as a context manager:</span>
<span class="sd">        ```python</span>
<span class="sd">        from prefect_snowflake.database import SnowflakeConnector</span>

<span class="sd">        snowflake_connector = SnowflakeConnector.load(&quot;BLOCK_NAME&quot;):</span>
<span class="sd">        ```</span>

<span class="sd">        Insert data into database and fetch results.</span>
<span class="sd">        ```python</span>
<span class="sd">        from prefect_snowflake.database import SnowflakeConnector</span>

<span class="sd">        with SnowflakeConnector.load(&quot;BLOCK_NAME&quot;) as conn:</span>
<span class="sd">            conn.execute(</span>
<span class="sd">                &quot;CREATE TABLE IF NOT EXISTS customers (name varchar, address varchar);&quot;</span>
<span class="sd">            )</span>
<span class="sd">            conn.execute_many(</span>
<span class="sd">                &quot;INSERT INTO customers (name, address) VALUES (%(name)s, %(address)s);&quot;,</span>
<span class="sd">                seq_of_parameters=[</span>
<span class="sd">                    {&quot;name&quot;: &quot;Ford&quot;, &quot;address&quot;: &quot;Highway 42&quot;},</span>
<span class="sd">                    {&quot;name&quot;: &quot;Unknown&quot;, &quot;address&quot;: &quot;Space&quot;},</span>
<span class="sd">                    {&quot;name&quot;: &quot;Me&quot;, &quot;address&quot;: &quot;Myway 88&quot;},</span>
<span class="sd">                ],</span>
<span class="sd">            )</span>
<span class="sd">            results = conn.fetch_all(</span>
<span class="sd">                &quot;SELECT * FROM customers WHERE address = %(address)s&quot;,</span>
<span class="sd">                parameters={&quot;address&quot;: &quot;Space&quot;}</span>
<span class="sd">            )</span>
<span class="sd">            print(results)</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>

    <span class="n">_block_type_name</span> <span class="o">=</span> <span class="s2">&quot;Snowflake Connector&quot;</span>
    <span class="n">_logo_url</span> <span class="o">=</span> <span class="s2">&quot;https://images.ctfassets.net/gm98wzqotmnx/2DxzAeTM9eHLDcRQx1FR34/f858a501cdff918d398b39365ec2150f/snowflake.png?h=250&quot;</span>  <span class="c1"># noqa</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s2">&quot;Perform data operations against a Snowflake database.&quot;</span>

    <span class="n">credentials</span><span class="p">:</span> <span class="n">SnowflakeCredentials</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The credentials to authenticate with Snowflake.&quot;</span>
    <span class="p">)</span>
    <span class="n">database</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The name of the default database to use.&quot;</span>
    <span class="p">)</span>
    <span class="n">warehouse</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The name of the default warehouse to use.&quot;</span>
    <span class="p">)</span>
    <span class="n">schema_</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=...</span><span class="p">,</span>
        <span class="n">alias</span><span class="o">=</span><span class="s2">&quot;schema&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The name of the default schema to use.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fetch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The default number of rows to fetch at a time.&quot;</span>
    <span class="p">)</span>
    <span class="n">poll_frequency_s</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Poll Frequency [seconds]&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The number of seconds between checking query &quot;</span>
            <span class="s2">&quot;status for long running queries.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="n">_connection</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SnowflakeConnection</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_unique_cursors</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">SnowflakeCursor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">get_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">connect_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">SnowflakeConnection</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an authenticated connection that can be</span>
<span class="sd">        used to query from Snowflake databases.</span>

<span class="sd">        Args:</span>
<span class="sd">            **connect_kwargs: Additional arguments to pass to</span>
<span class="sd">                `snowflake.connector.connect`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The authenticated SnowflakeConnection.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```python</span>
<span class="sd">            from prefect_snowflake.credentials import SnowflakeCredentials</span>
<span class="sd">            from prefect_snowflake.database import SnowflakeConnector</span>

<span class="sd">            snowflake_credentials = SnowflakeCredentials(</span>
<span class="sd">                account=&quot;account&quot;,</span>
<span class="sd">                user=&quot;user&quot;,</span>
<span class="sd">                password=&quot;password&quot;,</span>
<span class="sd">            )</span>
<span class="sd">            snowflake_connector = SnowflakeConnector(</span>
<span class="sd">                database=&quot;database&quot;,</span>
<span class="sd">                warehouse=&quot;warehouse&quot;,</span>
<span class="sd">                schema=&quot;schema&quot;,</span>
<span class="sd">                credentials=snowflake_credentials</span>
<span class="sd">            )</span>
<span class="sd">            with snowflake_connector.get_connection() as connection:</span>
<span class="sd">                ...</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span>

        <span class="n">connect_params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;database&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">,</span>
            <span class="s2">&quot;warehouse&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">warehouse</span><span class="p">,</span>
            <span class="s2">&quot;schema&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema_</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get_client</span><span class="p">(</span><span class="o">**</span><span class="n">connect_kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">connect_params</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">connection</span>

    <span class="k">def</span> <span class="nf">_start_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Starts Snowflake database connection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connection</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">block_initialization</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">block_initialization</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_start_connection</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unique_cursors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_unique_cursors</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_get_cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">SnowflakeCursor</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a Snowflake cursor.</span>

<span class="sd">        Args:</span>
<span class="sd">            inputs: The inputs to generate a unique hash, used to decide</span>
<span class="sd">                whether a new cursor should be used.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Whether a cursor is new and a Snowflake cursor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">input_hash</span> <span class="o">=</span> <span class="n">hash_objects</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">input_hash</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;We were not able to hash your inputs, &quot;</span>
                <span class="s2">&quot;which resulted in an unexpected data return; &quot;</span>
                <span class="s2">&quot;please open an issue with a reproducible example.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">input_hash</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unique_cursors</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">new_cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_unique_cursors</span><span class="p">[</span><span class="n">input_hash</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_cursor</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">new_cursor</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">existing_cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unique_cursors</span><span class="p">[</span><span class="n">input_hash</span><span class="p">]</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">existing_cursor</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_execute_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursor</span><span class="p">:</span> <span class="n">SnowflakeCursor</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Helper method to execute operations asynchronously.&quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute_async</span><span class="p">,</span> <span class="o">**</span><span class="n">inputs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Executing the operation, </span><span class="si">{</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;command&#39;</span><span class="p">]</span><span class="si">!r}</span><span class="s2">, asynchronously; &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;polling for the result every </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">poll_frequency_s</span><span class="si">}</span><span class="s2"> seconds.&quot;</span>
        <span class="p">)</span>

        <span class="n">query_id</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;queryId&quot;</span><span class="p">]</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">is_still_running</span><span class="p">(</span>
            <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">get_query_status_throw_if_error</span><span class="p">,</span> <span class="n">query_id</span>
            <span class="p">)</span>
        <span class="p">):</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">poll_frequency_s</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">get_results_from_sfqid</span><span class="p">,</span> <span class="n">query_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">reset_cursors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tries to close all opened cursors.</span>

<span class="sd">        Examples:</span>
<span class="sd">            Reset the cursors to refresh cursor position.</span>
<span class="sd">            ```python</span>
<span class="sd">            from prefect_snowflake.database import SnowflakeConnector</span>

<span class="sd">            with SnowflakeConnector.load(&quot;BLOCK_NAME&quot;) as conn:</span>
<span class="sd">                conn.execute(</span>
<span class="sd">                    &quot;CREATE TABLE IF NOT EXISTS customers (name varchar, address varchar);&quot;</span>
<span class="sd">                )</span>
<span class="sd">                conn.execute_many(</span>
<span class="sd">                    &quot;INSERT INTO customers (name, address) VALUES (%(name)s, %(address)s);&quot;,</span>
<span class="sd">                    seq_of_parameters=[</span>
<span class="sd">                        {&quot;name&quot;: &quot;Ford&quot;, &quot;address&quot;: &quot;Highway 42&quot;},</span>
<span class="sd">                        {&quot;name&quot;: &quot;Unknown&quot;, &quot;address&quot;: &quot;Space&quot;},</span>
<span class="sd">                        {&quot;name&quot;: &quot;Me&quot;, &quot;address&quot;: &quot;Myway 88&quot;},</span>
<span class="sd">                    ],</span>
<span class="sd">                )</span>
<span class="sd">                print(conn.fetch_one(&quot;SELECT * FROM customers&quot;))  # Ford</span>
<span class="sd">                conn.reset_cursors()</span>
<span class="sd">                print(conn.fetch_one(&quot;SELECT * FROM customers&quot;))  # should be Ford again</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>
        <span class="n">input_hashes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_unique_cursors</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">input_hash</span> <span class="ow">in</span> <span class="n">input_hashes</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unique_cursors</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">input_hash</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Failed to close cursor for input hash </span><span class="si">{</span><span class="n">input_hash</span><span class="si">!r}</span><span class="s2">: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully reset the cursors.&quot;</span><span class="p">)</span>

    <span class="nd">@sync_compatible</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">fetch_one</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">operation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">execute_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetch a single result from the database.</span>
<span class="sd">        Repeated calls using the same inputs to *any* of the fetch methods of this</span>
<span class="sd">        block will skip executing the operation again, and instead,</span>
<span class="sd">        return the next set of results from the previous execution,</span>
<span class="sd">        until the reset_cursors method is called.</span>

<span class="sd">        Args:</span>
<span class="sd">            operation: The SQL query or other operation to be executed.</span>
<span class="sd">            parameters: The parameters for the operation.</span>
<span class="sd">            **execute_kwargs: Additional options to pass to `cursor.execute_async`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple containing the data returned by the database,</span>
<span class="sd">                where each row is a tuple and each column is a value in the tuple.</span>

<span class="sd">        Examples:</span>
<span class="sd">            Fetch one row from the database where address is Space.</span>
<span class="sd">            ```python</span>
<span class="sd">            from prefect_snowflake.database import SnowflakeConnector</span>

<span class="sd">            with SnowflakeConnector.load(&quot;BLOCK_NAME&quot;) as conn:</span>
<span class="sd">                conn.execute(</span>
<span class="sd">                    &quot;CREATE TABLE IF NOT EXISTS customers (name varchar, address varchar);&quot;</span>
<span class="sd">                )</span>
<span class="sd">                conn.execute_many(</span>
<span class="sd">                    &quot;INSERT INTO customers (name, address) VALUES (%(name)s, %(address)s);&quot;,</span>
<span class="sd">                    seq_of_parameters=[</span>
<span class="sd">                        {&quot;name&quot;: &quot;Ford&quot;, &quot;address&quot;: &quot;Highway 42&quot;},</span>
<span class="sd">                        {&quot;name&quot;: &quot;Unknown&quot;, &quot;address&quot;: &quot;Space&quot;},</span>
<span class="sd">                        {&quot;name&quot;: &quot;Me&quot;, &quot;address&quot;: &quot;Myway 88&quot;},</span>
<span class="sd">                    ],</span>
<span class="sd">                )</span>
<span class="sd">                result = conn.fetch_one(</span>
<span class="sd">                    &quot;SELECT * FROM customers WHERE address = %(address)s&quot;,</span>
<span class="sd">                    parameters={&quot;address&quot;: &quot;Space&quot;}</span>
<span class="sd">                )</span>
<span class="sd">                print(result)</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">command</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
            <span class="o">**</span><span class="n">execute_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">new</span><span class="p">,</span> <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cursor</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">new</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_async</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">inputs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Preparing to fetch a row.&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@sync_compatible</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">fetch_many</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">operation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">execute_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetch a limited number of results from the database.</span>
<span class="sd">        Repeated calls using the same inputs to *any* of the fetch methods of this</span>
<span class="sd">        block will skip executing the operation again, and instead,</span>
<span class="sd">        return the next set of results from the previous execution,</span>
<span class="sd">        until the reset_cursors method is called.</span>

<span class="sd">        Args:</span>
<span class="sd">            operation: The SQL query or other operation to be executed.</span>
<span class="sd">            parameters: The parameters for the operation.</span>
<span class="sd">            size: The number of results to return; if None or 0, uses the value of</span>
<span class="sd">                `fetch_size` configured on the block.</span>
<span class="sd">            **execute_kwargs: Additional options to pass to `cursor.execute_async`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of tuples containing the data returned by the database,</span>
<span class="sd">                where each row is a tuple and each column is a value in the tuple.</span>

<span class="sd">        Examples:</span>
<span class="sd">            Repeatedly fetch two rows from the database where address is Highway 42.</span>
<span class="sd">            ```python</span>
<span class="sd">            from prefect_snowflake.database import SnowflakeConnector</span>

<span class="sd">            with SnowflakeConnector.load(&quot;BLOCK_NAME&quot;) as conn:</span>
<span class="sd">                conn.execute(</span>
<span class="sd">                    &quot;CREATE TABLE IF NOT EXISTS customers (name varchar, address varchar);&quot;</span>
<span class="sd">                )</span>
<span class="sd">                conn.execute_many(</span>
<span class="sd">                    &quot;INSERT INTO customers (name, address) VALUES (%(name)s, %(address)s);&quot;,</span>
<span class="sd">                    seq_of_parameters=[</span>
<span class="sd">                        {&quot;name&quot;: &quot;Marvin&quot;, &quot;address&quot;: &quot;Highway 42&quot;},</span>
<span class="sd">                        {&quot;name&quot;: &quot;Ford&quot;, &quot;address&quot;: &quot;Highway 42&quot;},</span>
<span class="sd">                        {&quot;name&quot;: &quot;Unknown&quot;, &quot;address&quot;: &quot;Highway 42&quot;},</span>
<span class="sd">                        {&quot;name&quot;: &quot;Me&quot;, &quot;address&quot;: &quot;Highway 42&quot;},</span>
<span class="sd">                    ],</span>
<span class="sd">                )</span>
<span class="sd">                result = conn.fetch_many(</span>
<span class="sd">                    &quot;SELECT * FROM customers WHERE address = %(address)s&quot;,</span>
<span class="sd">                    parameters={&quot;address&quot;: &quot;Highway 42&quot;},</span>
<span class="sd">                    size=2</span>
<span class="sd">                )</span>
<span class="sd">                print(result)  # Marvin, Ford</span>
<span class="sd">                result = conn.fetch_many(</span>
<span class="sd">                    &quot;SELECT * FROM customers WHERE address = %(address)s&quot;,</span>
<span class="sd">                    parameters={&quot;address&quot;: &quot;Highway 42&quot;},</span>
<span class="sd">                    size=2</span>
<span class="sd">                )</span>
<span class="sd">                print(result)  # Unknown, Me</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">command</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
            <span class="o">**</span><span class="n">execute_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">new</span><span class="p">,</span> <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cursor</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">new</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_async</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">inputs</span><span class="p">)</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">size</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Preparing to fetch </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2"> rows.&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchmany</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@sync_compatible</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">fetch_all</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">operation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">execute_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetch all results from the database.</span>
<span class="sd">        Repeated calls using the same inputs to *any* of the fetch methods of this</span>
<span class="sd">        block will skip executing the operation again, and instead,</span>
<span class="sd">        return the next set of results from the previous execution,</span>
<span class="sd">        until the reset_cursors method is called.</span>

<span class="sd">        Args:</span>
<span class="sd">            operation: The SQL query or other operation to be executed.</span>
<span class="sd">            parameters: The parameters for the operation.</span>
<span class="sd">            **execute_kwargs: Additional options to pass to `cursor.execute_async`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of tuples containing the data returned by the database,</span>
<span class="sd">                where each row is a tuple and each column is a value in the tuple.</span>

<span class="sd">        Examples:</span>
<span class="sd">            Fetch all rows from the database where address is Highway 42.</span>
<span class="sd">            ```python</span>
<span class="sd">            from prefect_snowflake.database import SnowflakeConnector</span>

<span class="sd">            with SnowflakeConnector.load(&quot;BLOCK_NAME&quot;) as conn:</span>
<span class="sd">                conn.execute(</span>
<span class="sd">                    &quot;CREATE TABLE IF NOT EXISTS customers (name varchar, address varchar);&quot;</span>
<span class="sd">                )</span>
<span class="sd">                conn.execute_many(</span>
<span class="sd">                    &quot;INSERT INTO customers (name, address) VALUES (%(name)s, %(address)s);&quot;,</span>
<span class="sd">                    seq_of_parameters=[</span>
<span class="sd">                        {&quot;name&quot;: &quot;Marvin&quot;, &quot;address&quot;: &quot;Highway 42&quot;},</span>
<span class="sd">                        {&quot;name&quot;: &quot;Ford&quot;, &quot;address&quot;: &quot;Highway 42&quot;},</span>
<span class="sd">                        {&quot;name&quot;: &quot;Unknown&quot;, &quot;address&quot;: &quot;Highway 42&quot;},</span>
<span class="sd">                        {&quot;name&quot;: &quot;Me&quot;, &quot;address&quot;: &quot;Myway 88&quot;},</span>
<span class="sd">                    ],</span>
<span class="sd">                )</span>
<span class="sd">                result = conn.fetch_all(</span>
<span class="sd">                    &quot;SELECT * FROM customers WHERE address = %(address)s&quot;,</span>
<span class="sd">                    parameters={&quot;address&quot;: &quot;Highway 42&quot;},</span>
<span class="sd">                )</span>
<span class="sd">                print(result)  # Marvin, Ford, Unknown</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">command</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
            <span class="o">**</span><span class="n">execute_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">new</span><span class="p">,</span> <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cursor</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">new</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_async</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">inputs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Preparing to fetch all rows.&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@sync_compatible</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">operation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">execute_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes an operation on the database. This method is intended to be used</span>
<span class="sd">        for operations that do not return data, such as INSERT, UPDATE, or DELETE.</span>
<span class="sd">        Unlike the fetch methods, this method will always execute the operation</span>
<span class="sd">        upon calling.</span>

<span class="sd">        Args:</span>
<span class="sd">            operation: The SQL query or other operation to be executed.</span>
<span class="sd">            parameters: The parameters for the operation.</span>
<span class="sd">            **execute_kwargs: Additional options to pass to `cursor.execute_async`.</span>

<span class="sd">        Examples:</span>
<span class="sd">            Create table named customers with two columns, name and address.</span>
<span class="sd">            ```python</span>
<span class="sd">            from prefect_snowflake.database import SnowflakeConnector</span>

<span class="sd">            with SnowflakeConnector.load(&quot;BLOCK_NAME&quot;) as conn:</span>
<span class="sd">                conn.execute(</span>
<span class="sd">                    &quot;CREATE TABLE IF NOT EXISTS customers (name varchar, address varchar);&quot;</span>
<span class="sd">                )</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">command</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
            <span class="o">**</span><span class="n">execute_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">,</span> <span class="o">**</span><span class="n">inputs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Executed the operation, </span><span class="si">{</span><span class="n">operation</span><span class="si">!r}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="nd">@sync_compatible</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">execute_many</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">operation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">seq_of_parameters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes many operations on the database. This method is intended to be used</span>
<span class="sd">        for operations that do not return data, such as INSERT, UPDATE, or DELETE.</span>
<span class="sd">        Unlike the fetch methods, this method will always execute the operations</span>
<span class="sd">        upon calling.</span>

<span class="sd">        Args:</span>
<span class="sd">            operation: The SQL query or other operation to be executed.</span>
<span class="sd">            seq_of_parameters: The sequence of parameters for the operation.</span>

<span class="sd">        Examples:</span>
<span class="sd">            Create table and insert three rows into it.</span>
<span class="sd">            ```python</span>
<span class="sd">            from prefect_snowflake.database import SnowflakeConnector</span>

<span class="sd">            with SnowflakeConnector.load(&quot;BLOCK_NAME&quot;) as conn:</span>
<span class="sd">                conn.execute(</span>
<span class="sd">                    &quot;CREATE TABLE IF NOT EXISTS customers (name varchar, address varchar);&quot;</span>
<span class="sd">                )</span>
<span class="sd">                conn.execute_many(</span>
<span class="sd">                    &quot;INSERT INTO customers (name, address) VALUES (%(name)s, %(address)s);&quot;,</span>
<span class="sd">                    seq_of_parameters=[</span>
<span class="sd">                        {&quot;name&quot;: &quot;Marvin&quot;, &quot;address&quot;: &quot;Highway 42&quot;},</span>
<span class="sd">                        {&quot;name&quot;: &quot;Ford&quot;, &quot;address&quot;: &quot;Highway 42&quot;},</span>
<span class="sd">                        {&quot;name&quot;: &quot;Unknown&quot;, &quot;address&quot;: &quot;Space&quot;},</span>
<span class="sd">                    ],</span>
<span class="sd">                )</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">command</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span>
            <span class="n">seqparams</span><span class="o">=</span><span class="n">seq_of_parameters</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">,</span> <span class="o">**</span><span class="n">inputs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Executed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">seq_of_parameters</span><span class="p">)</span><span class="si">}</span><span class="s2"> operations off </span><span class="si">{</span><span class="n">operation</span><span class="si">!r}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Closes connection and its cursors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset_cursors</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully closed the Snowflake connection.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start a connection upon entry.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Closes connection and its cursors upon exit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Allows block to be pickled and dumped.&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;_connection&quot;</span><span class="p">,</span> <span class="s2">&quot;_unique_cursors&quot;</span><span class="p">}})</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset connection and cursors upon loading.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_unique_cursors</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_connection</span><span class="p">()</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">




<h4 id="prefect_snowflake.database.SnowflakeConnector-attributes">Attributes</h4>


  <div class="doc doc-object doc-attribute">



<h5 id="prefect_snowflake.database.SnowflakeConnector.credentials" class="doc doc-heading">
<code class="highlight language-python"><span class="n">credentials</span><span class="p">:</span> <span class="n">SnowflakeCredentials</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
      <small class="doc doc-property doc-property-required"><code>required</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>The credentials to authenticate with Snowflake.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_snowflake.database.SnowflakeConnector.database" class="doc doc-heading">
<code class="highlight language-python"><span class="n">database</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
      <small class="doc doc-property doc-property-required"><code>required</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>The name of the default database to use.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_snowflake.database.SnowflakeConnector.fetch_size" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fetch_size</span><span class="p">:</span> <span class="nb">int</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>The default number of rows to fetch at a time.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_snowflake.database.SnowflakeConnector.poll_frequency_s" class="doc doc-heading">
<code class="highlight language-python"><span class="n">poll_frequency_s</span><span class="p">:</span> <span class="nb">int</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>The number of seconds between checking query status for long running queries.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_snowflake.database.SnowflakeConnector.schema_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">schema_</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
      <small class="doc doc-property doc-property-required"><code>required</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>The name of the default schema to use.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_snowflake.database.SnowflakeConnector.warehouse" class="doc doc-heading">
<code class="highlight language-python"><span class="n">warehouse</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
      <small class="doc doc-property doc-property-required"><code>required</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>The name of the default warehouse to use.</p>
    </div>

  </div>





<h4 id="prefect_snowflake.database.SnowflakeConnector-methods">Methods</h4>

  <div class="doc doc-object doc-method">



<h5 id="prefect_snowflake.database.SnowflakeConnector.__enter__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__enter__</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Start a connection upon entry.</p>

        <details class="quote">
          <summary>Source code in <code>prefect_snowflake/database.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Start a connection upon entry.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="prefect_snowflake.database.SnowflakeConnector.__exit__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__exit__</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Closes connection and its cursors upon exit.</p>

        <details class="quote">
          <summary>Source code in <code>prefect_snowflake/database.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Closes connection and its cursors upon exit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="prefect_snowflake.database.SnowflakeConnector.__getstate__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">__getstate__</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Allows block to be pickled and dumped.</p>

        <details class="quote">
          <summary>Source code in <code>prefect_snowflake/database.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Allows block to be pickled and dumped.&quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;_connection&quot;</span><span class="p">,</span> <span class="s2">&quot;_unique_cursors&quot;</span><span class="p">}})</span>
    <span class="k">return</span> <span class="n">data</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="prefect_snowflake.database.SnowflakeConnector.__json_encoder__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">__json_encoder__</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>partial(func, <em>args, </em>*keywords) - new function with partial application
of the given arguments and keywords.</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="prefect_snowflake.database.SnowflakeConnector.__setstate__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">__setstate__</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Reset connection and cursors upon loading.</p>

        <details class="quote">
          <summary>Source code in <code>prefect_snowflake/database.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Reset connection and cursors upon loading.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_unique_cursors</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_start_connection</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h5 id="prefect_snowflake.database.SnowflakeConnector.close" class="doc doc-heading">
<code class="highlight language-python"><span class="n">close</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Closes connection and its cursors.</p>

        <details class="quote">
          <summary>Source code in <code>prefect_snowflake/database.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Closes connection and its cursors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_cursors</span><span class="p">()</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully closed the Snowflake connection.&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="prefect_snowflake.database.SnowflakeConnector.execute" class="doc doc-heading">
<code class="highlight language-python"><span class="n">execute</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-async"><code>async</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Executes an operation on the database. This method is intended to be used
for operations that do not return data, such as INSERT, UPDATE, or DELETE.
Unlike the fetch methods, this method will always execute the operation
upon calling.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>operation</code></td>
        <td><code>str</code></td>
        <td><p>The SQL query or other operation to be executed.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>parameters</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>The parameters for the operation.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>**execute_kwargs</code></td>
        <td><code>Dict[str, Any]</code></td>
        <td><p>Additional options to pass to <code>cursor.execute_async</code>.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <p>Create table named customers with two columns, name and address.
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">prefect_snowflake.database</span> <span class="kn">import</span> <span class="n">SnowflakeConnector</span>

<span class="k">with</span> <span class="n">SnowflakeConnector</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;BLOCK_NAME&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="s2">&quot;CREATE TABLE IF NOT EXISTS customers (name varchar, address varchar);&quot;</span>
    <span class="p">)</span>
</code></pre></div></p>

        <details class="quote">
          <summary>Source code in <code>prefect_snowflake/database.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@sync_compatible</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">operation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">execute_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Executes an operation on the database. This method is intended to be used</span>
<span class="sd">    for operations that do not return data, such as INSERT, UPDATE, or DELETE.</span>
<span class="sd">    Unlike the fetch methods, this method will always execute the operation</span>
<span class="sd">    upon calling.</span>

<span class="sd">    Args:</span>
<span class="sd">        operation: The SQL query or other operation to be executed.</span>
<span class="sd">        parameters: The parameters for the operation.</span>
<span class="sd">        **execute_kwargs: Additional options to pass to `cursor.execute_async`.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Create table named customers with two columns, name and address.</span>
<span class="sd">        ```python</span>
<span class="sd">        from prefect_snowflake.database import SnowflakeConnector</span>

<span class="sd">        with SnowflakeConnector.load(&quot;BLOCK_NAME&quot;) as conn:</span>
<span class="sd">            conn.execute(</span>
<span class="sd">                &quot;CREATE TABLE IF NOT EXISTS customers (name varchar, address varchar);&quot;</span>
<span class="sd">            )</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">command</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span>
        <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
        <span class="o">**</span><span class="n">execute_kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">,</span> <span class="o">**</span><span class="n">inputs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Executed the operation, </span><span class="si">{</span><span class="n">operation</span><span class="si">!r}</span><span class="s2">.&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="prefect_snowflake.database.SnowflakeConnector.execute_many" class="doc doc-heading">
<code class="highlight language-python"><span class="n">execute_many</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-async"><code>async</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Executes many operations on the database. This method is intended to be used
for operations that do not return data, such as INSERT, UPDATE, or DELETE.
Unlike the fetch methods, this method will always execute the operations
upon calling.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>operation</code></td>
        <td><code>str</code></td>
        <td><p>The SQL query or other operation to be executed.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>seq_of_parameters</code></td>
        <td><code>List[Dict[str, Any]]</code></td>
        <td><p>The sequence of parameters for the operation.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <p>Create table and insert three rows into it.
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">prefect_snowflake.database</span> <span class="kn">import</span> <span class="n">SnowflakeConnector</span>

<span class="k">with</span> <span class="n">SnowflakeConnector</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;BLOCK_NAME&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="s2">&quot;CREATE TABLE IF NOT EXISTS customers (name varchar, address varchar);&quot;</span>
    <span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute_many</span><span class="p">(</span>
        <span class="s2">&quot;INSERT INTO customers (name, address) VALUES (</span><span class="si">%(name)s</span><span class="s2">, </span><span class="si">%(address)s</span><span class="s2">);&quot;</span><span class="p">,</span>
        <span class="n">seq_of_parameters</span><span class="o">=</span><span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Marvin&quot;</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;Highway 42&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Ford&quot;</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;Highway 42&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;Space&quot;</span><span class="p">},</span>
        <span class="p">],</span>
    <span class="p">)</span>
</code></pre></div></p>

        <details class="quote">
          <summary>Source code in <code>prefect_snowflake/database.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@sync_compatible</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">execute_many</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">operation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">seq_of_parameters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Executes many operations on the database. This method is intended to be used</span>
<span class="sd">    for operations that do not return data, such as INSERT, UPDATE, or DELETE.</span>
<span class="sd">    Unlike the fetch methods, this method will always execute the operations</span>
<span class="sd">    upon calling.</span>

<span class="sd">    Args:</span>
<span class="sd">        operation: The SQL query or other operation to be executed.</span>
<span class="sd">        seq_of_parameters: The sequence of parameters for the operation.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Create table and insert three rows into it.</span>
<span class="sd">        ```python</span>
<span class="sd">        from prefect_snowflake.database import SnowflakeConnector</span>

<span class="sd">        with SnowflakeConnector.load(&quot;BLOCK_NAME&quot;) as conn:</span>
<span class="sd">            conn.execute(</span>
<span class="sd">                &quot;CREATE TABLE IF NOT EXISTS customers (name varchar, address varchar);&quot;</span>
<span class="sd">            )</span>
<span class="sd">            conn.execute_many(</span>
<span class="sd">                &quot;INSERT INTO customers (name, address) VALUES (%(name)s, %(address)s);&quot;,</span>
<span class="sd">                seq_of_parameters=[</span>
<span class="sd">                    {&quot;name&quot;: &quot;Marvin&quot;, &quot;address&quot;: &quot;Highway 42&quot;},</span>
<span class="sd">                    {&quot;name&quot;: &quot;Ford&quot;, &quot;address&quot;: &quot;Highway 42&quot;},</span>
<span class="sd">                    {&quot;name&quot;: &quot;Unknown&quot;, &quot;address&quot;: &quot;Space&quot;},</span>
<span class="sd">                ],</span>
<span class="sd">            )</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">command</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span>
        <span class="n">seqparams</span><span class="o">=</span><span class="n">seq_of_parameters</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">,</span> <span class="o">**</span><span class="n">inputs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Executed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">seq_of_parameters</span><span class="p">)</span><span class="si">}</span><span class="s2"> operations off </span><span class="si">{</span><span class="n">operation</span><span class="si">!r}</span><span class="s2">.&quot;</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="prefect_snowflake.database.SnowflakeConnector.fetch_all" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fetch_all</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-async"><code>async</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Fetch all results from the database.
Repeated calls using the same inputs to <em>any</em> of the fetch methods of this
block will skip executing the operation again, and instead,
return the next set of results from the previous execution,
until the reset_cursors method is called.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>operation</code></td>
        <td><code>str</code></td>
        <td><p>The SQL query or other operation to be executed.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>parameters</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>The parameters for the operation.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>**execute_kwargs</code></td>
        <td><code>Dict[str, Any]</code></td>
        <td><p>Additional options to pass to <code>cursor.execute_async</code>.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>List[Tuple[Any]]</code></td>
      <td><p>A list of tuples containing the data returned by the database,
    where each row is a tuple and each column is a value in the tuple.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <p>Fetch all rows from the database where address is Highway 42.
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">prefect_snowflake.database</span> <span class="kn">import</span> <span class="n">SnowflakeConnector</span>

<span class="k">with</span> <span class="n">SnowflakeConnector</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;BLOCK_NAME&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="s2">&quot;CREATE TABLE IF NOT EXISTS customers (name varchar, address varchar);&quot;</span>
    <span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute_many</span><span class="p">(</span>
        <span class="s2">&quot;INSERT INTO customers (name, address) VALUES (</span><span class="si">%(name)s</span><span class="s2">, </span><span class="si">%(address)s</span><span class="s2">);&quot;</span><span class="p">,</span>
        <span class="n">seq_of_parameters</span><span class="o">=</span><span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Marvin&quot;</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;Highway 42&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Ford&quot;</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;Highway 42&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;Highway 42&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Me&quot;</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;Myway 88&quot;</span><span class="p">},</span>
        <span class="p">],</span>
    <span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">fetch_all</span><span class="p">(</span>
        <span class="s2">&quot;SELECT * FROM customers WHERE address = </span><span class="si">%(address)s</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;Highway 42&quot;</span><span class="p">},</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>  <span class="c1"># Marvin, Ford, Unknown</span>
</code></pre></div></p>

        <details class="quote">
          <summary>Source code in <code>prefect_snowflake/database.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@sync_compatible</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">fetch_all</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">operation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">execute_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fetch all results from the database.</span>
<span class="sd">    Repeated calls using the same inputs to *any* of the fetch methods of this</span>
<span class="sd">    block will skip executing the operation again, and instead,</span>
<span class="sd">    return the next set of results from the previous execution,</span>
<span class="sd">    until the reset_cursors method is called.</span>

<span class="sd">    Args:</span>
<span class="sd">        operation: The SQL query or other operation to be executed.</span>
<span class="sd">        parameters: The parameters for the operation.</span>
<span class="sd">        **execute_kwargs: Additional options to pass to `cursor.execute_async`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of tuples containing the data returned by the database,</span>
<span class="sd">            where each row is a tuple and each column is a value in the tuple.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Fetch all rows from the database where address is Highway 42.</span>
<span class="sd">        ```python</span>
<span class="sd">        from prefect_snowflake.database import SnowflakeConnector</span>

<span class="sd">        with SnowflakeConnector.load(&quot;BLOCK_NAME&quot;) as conn:</span>
<span class="sd">            conn.execute(</span>
<span class="sd">                &quot;CREATE TABLE IF NOT EXISTS customers (name varchar, address varchar);&quot;</span>
<span class="sd">            )</span>
<span class="sd">            conn.execute_many(</span>
<span class="sd">                &quot;INSERT INTO customers (name, address) VALUES (%(name)s, %(address)s);&quot;,</span>
<span class="sd">                seq_of_parameters=[</span>
<span class="sd">                    {&quot;name&quot;: &quot;Marvin&quot;, &quot;address&quot;: &quot;Highway 42&quot;},</span>
<span class="sd">                    {&quot;name&quot;: &quot;Ford&quot;, &quot;address&quot;: &quot;Highway 42&quot;},</span>
<span class="sd">                    {&quot;name&quot;: &quot;Unknown&quot;, &quot;address&quot;: &quot;Highway 42&quot;},</span>
<span class="sd">                    {&quot;name&quot;: &quot;Me&quot;, &quot;address&quot;: &quot;Myway 88&quot;},</span>
<span class="sd">                ],</span>
<span class="sd">            )</span>
<span class="sd">            result = conn.fetch_all(</span>
<span class="sd">                &quot;SELECT * FROM customers WHERE address = %(address)s&quot;,</span>
<span class="sd">                parameters={&quot;address&quot;: &quot;Highway 42&quot;},</span>
<span class="sd">            )</span>
<span class="sd">            print(result)  # Marvin, Ford, Unknown</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">command</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span>
        <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
        <span class="o">**</span><span class="n">execute_kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">new</span><span class="p">,</span> <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cursor</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">new</span><span class="p">:</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_async</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">inputs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Preparing to fetch all rows.&quot;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="prefect_snowflake.database.SnowflakeConnector.fetch_many" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fetch_many</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-async"><code>async</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Fetch a limited number of results from the database.
Repeated calls using the same inputs to <em>any</em> of the fetch methods of this
block will skip executing the operation again, and instead,
return the next set of results from the previous execution,
until the reset_cursors method is called.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>operation</code></td>
        <td><code>str</code></td>
        <td><p>The SQL query or other operation to be executed.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>parameters</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>The parameters for the operation.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>size</code></td>
        <td><code>Optional[int]</code></td>
        <td><p>The number of results to return; if None or 0, uses the value of
<code>fetch_size</code> configured on the block.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>**execute_kwargs</code></td>
        <td><code>Dict[str, Any]</code></td>
        <td><p>Additional options to pass to <code>cursor.execute_async</code>.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>List[Tuple[Any]]</code></td>
      <td><p>A list of tuples containing the data returned by the database,
    where each row is a tuple and each column is a value in the tuple.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <p>Repeatedly fetch two rows from the database where address is Highway 42.
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">prefect_snowflake.database</span> <span class="kn">import</span> <span class="n">SnowflakeConnector</span>

<span class="k">with</span> <span class="n">SnowflakeConnector</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;BLOCK_NAME&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="s2">&quot;CREATE TABLE IF NOT EXISTS customers (name varchar, address varchar);&quot;</span>
    <span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute_many</span><span class="p">(</span>
        <span class="s2">&quot;INSERT INTO customers (name, address) VALUES (</span><span class="si">%(name)s</span><span class="s2">, </span><span class="si">%(address)s</span><span class="s2">);&quot;</span><span class="p">,</span>
        <span class="n">seq_of_parameters</span><span class="o">=</span><span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Marvin&quot;</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;Highway 42&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Ford&quot;</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;Highway 42&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;Highway 42&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Me&quot;</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;Highway 42&quot;</span><span class="p">},</span>
        <span class="p">],</span>
    <span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">fetch_many</span><span class="p">(</span>
        <span class="s2">&quot;SELECT * FROM customers WHERE address = </span><span class="si">%(address)s</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;Highway 42&quot;</span><span class="p">},</span>
        <span class="n">size</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>  <span class="c1"># Marvin, Ford</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">fetch_many</span><span class="p">(</span>
        <span class="s2">&quot;SELECT * FROM customers WHERE address = </span><span class="si">%(address)s</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;Highway 42&quot;</span><span class="p">},</span>
        <span class="n">size</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>  <span class="c1"># Unknown, Me</span>
</code></pre></div></p>

        <details class="quote">
          <summary>Source code in <code>prefect_snowflake/database.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@sync_compatible</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">fetch_many</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">operation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">execute_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fetch a limited number of results from the database.</span>
<span class="sd">    Repeated calls using the same inputs to *any* of the fetch methods of this</span>
<span class="sd">    block will skip executing the operation again, and instead,</span>
<span class="sd">    return the next set of results from the previous execution,</span>
<span class="sd">    until the reset_cursors method is called.</span>

<span class="sd">    Args:</span>
<span class="sd">        operation: The SQL query or other operation to be executed.</span>
<span class="sd">        parameters: The parameters for the operation.</span>
<span class="sd">        size: The number of results to return; if None or 0, uses the value of</span>
<span class="sd">            `fetch_size` configured on the block.</span>
<span class="sd">        **execute_kwargs: Additional options to pass to `cursor.execute_async`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of tuples containing the data returned by the database,</span>
<span class="sd">            where each row is a tuple and each column is a value in the tuple.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Repeatedly fetch two rows from the database where address is Highway 42.</span>
<span class="sd">        ```python</span>
<span class="sd">        from prefect_snowflake.database import SnowflakeConnector</span>

<span class="sd">        with SnowflakeConnector.load(&quot;BLOCK_NAME&quot;) as conn:</span>
<span class="sd">            conn.execute(</span>
<span class="sd">                &quot;CREATE TABLE IF NOT EXISTS customers (name varchar, address varchar);&quot;</span>
<span class="sd">            )</span>
<span class="sd">            conn.execute_many(</span>
<span class="sd">                &quot;INSERT INTO customers (name, address) VALUES (%(name)s, %(address)s);&quot;,</span>
<span class="sd">                seq_of_parameters=[</span>
<span class="sd">                    {&quot;name&quot;: &quot;Marvin&quot;, &quot;address&quot;: &quot;Highway 42&quot;},</span>
<span class="sd">                    {&quot;name&quot;: &quot;Ford&quot;, &quot;address&quot;: &quot;Highway 42&quot;},</span>
<span class="sd">                    {&quot;name&quot;: &quot;Unknown&quot;, &quot;address&quot;: &quot;Highway 42&quot;},</span>
<span class="sd">                    {&quot;name&quot;: &quot;Me&quot;, &quot;address&quot;: &quot;Highway 42&quot;},</span>
<span class="sd">                ],</span>
<span class="sd">            )</span>
<span class="sd">            result = conn.fetch_many(</span>
<span class="sd">                &quot;SELECT * FROM customers WHERE address = %(address)s&quot;,</span>
<span class="sd">                parameters={&quot;address&quot;: &quot;Highway 42&quot;},</span>
<span class="sd">                size=2</span>
<span class="sd">            )</span>
<span class="sd">            print(result)  # Marvin, Ford</span>
<span class="sd">            result = conn.fetch_many(</span>
<span class="sd">                &quot;SELECT * FROM customers WHERE address = %(address)s&quot;,</span>
<span class="sd">                parameters={&quot;address&quot;: &quot;Highway 42&quot;},</span>
<span class="sd">                size=2</span>
<span class="sd">            )</span>
<span class="sd">            print(result)  # Unknown, Me</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">command</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span>
        <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
        <span class="o">**</span><span class="n">execute_kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">new</span><span class="p">,</span> <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cursor</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">new</span><span class="p">:</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_async</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">inputs</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">size</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_size</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Preparing to fetch </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2"> rows.&quot;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchmany</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="prefect_snowflake.database.SnowflakeConnector.fetch_one" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fetch_one</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-async"><code>async</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Fetch a single result from the database.
Repeated calls using the same inputs to <em>any</em> of the fetch methods of this
block will skip executing the operation again, and instead,
return the next set of results from the previous execution,
until the reset_cursors method is called.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>operation</code></td>
        <td><code>str</code></td>
        <td><p>The SQL query or other operation to be executed.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>parameters</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>The parameters for the operation.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>**execute_kwargs</code></td>
        <td><code>Dict[str, Any]</code></td>
        <td><p>Additional options to pass to <code>cursor.execute_async</code>.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Tuple[Any]</code></td>
      <td><p>A tuple containing the data returned by the database,
    where each row is a tuple and each column is a value in the tuple.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <p>Fetch one row from the database where address is Space.
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">prefect_snowflake.database</span> <span class="kn">import</span> <span class="n">SnowflakeConnector</span>

<span class="k">with</span> <span class="n">SnowflakeConnector</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;BLOCK_NAME&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="s2">&quot;CREATE TABLE IF NOT EXISTS customers (name varchar, address varchar);&quot;</span>
    <span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute_many</span><span class="p">(</span>
        <span class="s2">&quot;INSERT INTO customers (name, address) VALUES (</span><span class="si">%(name)s</span><span class="s2">, </span><span class="si">%(address)s</span><span class="s2">);&quot;</span><span class="p">,</span>
        <span class="n">seq_of_parameters</span><span class="o">=</span><span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Ford&quot;</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;Highway 42&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;Space&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Me&quot;</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;Myway 88&quot;</span><span class="p">},</span>
        <span class="p">],</span>
    <span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">fetch_one</span><span class="p">(</span>
        <span class="s2">&quot;SELECT * FROM customers WHERE address = </span><span class="si">%(address)s</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;Space&quot;</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></p>

        <details class="quote">
          <summary>Source code in <code>prefect_snowflake/database.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@sync_compatible</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">fetch_one</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">operation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">execute_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fetch a single result from the database.</span>
<span class="sd">    Repeated calls using the same inputs to *any* of the fetch methods of this</span>
<span class="sd">    block will skip executing the operation again, and instead,</span>
<span class="sd">    return the next set of results from the previous execution,</span>
<span class="sd">    until the reset_cursors method is called.</span>

<span class="sd">    Args:</span>
<span class="sd">        operation: The SQL query or other operation to be executed.</span>
<span class="sd">        parameters: The parameters for the operation.</span>
<span class="sd">        **execute_kwargs: Additional options to pass to `cursor.execute_async`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A tuple containing the data returned by the database,</span>
<span class="sd">            where each row is a tuple and each column is a value in the tuple.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Fetch one row from the database where address is Space.</span>
<span class="sd">        ```python</span>
<span class="sd">        from prefect_snowflake.database import SnowflakeConnector</span>

<span class="sd">        with SnowflakeConnector.load(&quot;BLOCK_NAME&quot;) as conn:</span>
<span class="sd">            conn.execute(</span>
<span class="sd">                &quot;CREATE TABLE IF NOT EXISTS customers (name varchar, address varchar);&quot;</span>
<span class="sd">            )</span>
<span class="sd">            conn.execute_many(</span>
<span class="sd">                &quot;INSERT INTO customers (name, address) VALUES (%(name)s, %(address)s);&quot;,</span>
<span class="sd">                seq_of_parameters=[</span>
<span class="sd">                    {&quot;name&quot;: &quot;Ford&quot;, &quot;address&quot;: &quot;Highway 42&quot;},</span>
<span class="sd">                    {&quot;name&quot;: &quot;Unknown&quot;, &quot;address&quot;: &quot;Space&quot;},</span>
<span class="sd">                    {&quot;name&quot;: &quot;Me&quot;, &quot;address&quot;: &quot;Myway 88&quot;},</span>
<span class="sd">                ],</span>
<span class="sd">            )</span>
<span class="sd">            result = conn.fetch_one(</span>
<span class="sd">                &quot;SELECT * FROM customers WHERE address = %(address)s&quot;,</span>
<span class="sd">                parameters={&quot;address&quot;: &quot;Space&quot;}</span>
<span class="sd">            )</span>
<span class="sd">            print(result)</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">command</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span>
        <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
        <span class="o">**</span><span class="n">execute_kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">new</span><span class="p">,</span> <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cursor</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">new</span><span class="p">:</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_async</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">inputs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Preparing to fetch a row.&quot;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="prefect_snowflake.database.SnowflakeConnector.get_connection" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_connection</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Returns an authenticated connection that can be
used to query from Snowflake databases.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>**connect_kwargs</code></td>
        <td><code>Dict[str, Any]</code></td>
        <td><p>Additional arguments to pass to
<code>snowflake.connector.connect</code>.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>SnowflakeConnection</code></td>
      <td><p>The authenticated SnowflakeConnection.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">prefect_snowflake.credentials</span> <span class="kn">import</span> <span class="n">SnowflakeCredentials</span>
<span class="kn">from</span> <span class="nn">prefect_snowflake.database</span> <span class="kn">import</span> <span class="n">SnowflakeConnector</span>

<span class="n">snowflake_credentials</span> <span class="o">=</span> <span class="n">SnowflakeCredentials</span><span class="p">(</span>
    <span class="n">account</span><span class="o">=</span><span class="s2">&quot;account&quot;</span><span class="p">,</span>
    <span class="n">user</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
    <span class="n">password</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">snowflake_connector</span> <span class="o">=</span> <span class="n">SnowflakeConnector</span><span class="p">(</span>
    <span class="n">database</span><span class="o">=</span><span class="s2">&quot;database&quot;</span><span class="p">,</span>
    <span class="n">warehouse</span><span class="o">=</span><span class="s2">&quot;warehouse&quot;</span><span class="p">,</span>
    <span class="n">schema</span><span class="o">=</span><span class="s2">&quot;schema&quot;</span><span class="p">,</span>
    <span class="n">credentials</span><span class="o">=</span><span class="n">snowflake_credentials</span>
<span class="p">)</span>
<span class="k">with</span> <span class="n">snowflake_connector</span><span class="o">.</span><span class="n">get_connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="o">...</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>prefect_snowflake/database.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">connect_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">SnowflakeConnection</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns an authenticated connection that can be</span>
<span class="sd">    used to query from Snowflake databases.</span>

<span class="sd">    Args:</span>
<span class="sd">        **connect_kwargs: Additional arguments to pass to</span>
<span class="sd">            `snowflake.connector.connect`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The authenticated SnowflakeConnection.</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        from prefect_snowflake.credentials import SnowflakeCredentials</span>
<span class="sd">        from prefect_snowflake.database import SnowflakeConnector</span>

<span class="sd">        snowflake_credentials = SnowflakeCredentials(</span>
<span class="sd">            account=&quot;account&quot;,</span>
<span class="sd">            user=&quot;user&quot;,</span>
<span class="sd">            password=&quot;password&quot;,</span>
<span class="sd">        )</span>
<span class="sd">        snowflake_connector = SnowflakeConnector(</span>
<span class="sd">            database=&quot;database&quot;,</span>
<span class="sd">            warehouse=&quot;warehouse&quot;,</span>
<span class="sd">            schema=&quot;schema&quot;,</span>
<span class="sd">            credentials=snowflake_credentials</span>
<span class="sd">        )</span>
<span class="sd">        with snowflake_connector.get_connection() as connection:</span>
<span class="sd">            ...</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span>

    <span class="n">connect_params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;database&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">,</span>
        <span class="s2">&quot;warehouse&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">warehouse</span><span class="p">,</span>
        <span class="s2">&quot;schema&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema_</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">connection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get_client</span><span class="p">(</span><span class="o">**</span><span class="n">connect_kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">connect_params</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">connection</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="prefect_snowflake.database.SnowflakeConnector.reset_cursors" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reset_cursors</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Tries to close all opened cursors.</p>

<p><strong>Examples:</strong></p>
    <p>Reset the cursors to refresh cursor position.
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">prefect_snowflake.database</span> <span class="kn">import</span> <span class="n">SnowflakeConnector</span>

<span class="k">with</span> <span class="n">SnowflakeConnector</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;BLOCK_NAME&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="s2">&quot;CREATE TABLE IF NOT EXISTS customers (name varchar, address varchar);&quot;</span>
    <span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute_many</span><span class="p">(</span>
        <span class="s2">&quot;INSERT INTO customers (name, address) VALUES (</span><span class="si">%(name)s</span><span class="s2">, </span><span class="si">%(address)s</span><span class="s2">);&quot;</span><span class="p">,</span>
        <span class="n">seq_of_parameters</span><span class="o">=</span><span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Ford&quot;</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;Highway 42&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;Space&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Me&quot;</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;Myway 88&quot;</span><span class="p">},</span>
        <span class="p">],</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">conn</span><span class="o">.</span><span class="n">fetch_one</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM customers&quot;</span><span class="p">))</span>  <span class="c1"># Ford</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">reset_cursors</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">conn</span><span class="o">.</span><span class="n">fetch_one</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM customers&quot;</span><span class="p">))</span>  <span class="c1"># should be Ford again</span>
</code></pre></div></p>

        <details class="quote">
          <summary>Source code in <code>prefect_snowflake/database.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">reset_cursors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tries to close all opened cursors.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Reset the cursors to refresh cursor position.</span>
<span class="sd">        ```python</span>
<span class="sd">        from prefect_snowflake.database import SnowflakeConnector</span>

<span class="sd">        with SnowflakeConnector.load(&quot;BLOCK_NAME&quot;) as conn:</span>
<span class="sd">            conn.execute(</span>
<span class="sd">                &quot;CREATE TABLE IF NOT EXISTS customers (name varchar, address varchar);&quot;</span>
<span class="sd">            )</span>
<span class="sd">            conn.execute_many(</span>
<span class="sd">                &quot;INSERT INTO customers (name, address) VALUES (%(name)s, %(address)s);&quot;,</span>
<span class="sd">                seq_of_parameters=[</span>
<span class="sd">                    {&quot;name&quot;: &quot;Ford&quot;, &quot;address&quot;: &quot;Highway 42&quot;},</span>
<span class="sd">                    {&quot;name&quot;: &quot;Unknown&quot;, &quot;address&quot;: &quot;Space&quot;},</span>
<span class="sd">                    {&quot;name&quot;: &quot;Me&quot;, &quot;address&quot;: &quot;Myway 88&quot;},</span>
<span class="sd">                ],</span>
<span class="sd">            )</span>
<span class="sd">            print(conn.fetch_one(&quot;SELECT * FROM customers&quot;))  # Ford</span>
<span class="sd">            conn.reset_cursors()</span>
<span class="sd">            print(conn.fetch_one(&quot;SELECT * FROM customers&quot;))  # should be Ford again</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>
    <span class="n">input_hashes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_unique_cursors</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">input_hash</span> <span class="ow">in</span> <span class="n">input_hashes</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unique_cursors</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">input_hash</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to close cursor for input hash </span><span class="si">{</span><span class="n">input_hash</span><span class="si">!r}</span><span class="s2">: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully reset the cursors.&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>


<h2 id="prefect_snowflake.database-functions">Functions</h2>

  <div class="doc doc-object doc-function">



<h3 id="prefect_snowflake.database.snowflake_multiquery" class="doc doc-heading">
<code class="highlight language-python"><span class="n">snowflake_multiquery</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-async"><code>async</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">

      <p>Executes multiple queries against a Snowflake database in a shared session.
Allows execution in a transaction.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>queries</code></td>
        <td><code>List[str]</code></td>
        <td><p>The list of queries to execute against the database.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>params</code></td>
        <td><code>Union[Tuple[Any], Dict[str, Any]]</code></td>
        <td><p>The params to replace the placeholders in the query.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>snowflake_connector</code></td>
        <td><code>SnowflakeConnector</code></td>
        <td><p>The credentials to use to authenticate.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>cursor_type</code></td>
        <td><code>SnowflakeCursor</code></td>
        <td><p>The type of database cursor to use for the query.</p></td>
        <td><code>&lt;class &#39;snowflake.connector.cursor.SnowflakeCursor&#39;&gt;</code></td>
      </tr>
      <tr>
        <td><code>as_transaction</code></td>
        <td><code>bool</code></td>
        <td><p>If True, queries are executed in a transaction.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>return_transaction_control_results</code></td>
        <td><code>bool</code></td>
        <td><p>Determines if the results of queries
controlling the transaction (BEGIN/COMMIT) should be returned.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>poll_frequency_seconds</code></td>
        <td><code>int</code></td>
        <td><p>Number of seconds to wait in between checks for
run completion.</p></td>
        <td><code>1</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>List[List[Tuple[Any]]]</code></td>
      <td><p>List of the outputs of <code>response.fetchall()</code> for each query.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <p>Query Snowflake table with the ID value parameterized.
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">prefect</span> <span class="kn">import</span> <span class="n">flow</span>
<span class="kn">from</span> <span class="nn">prefect_snowflake.credentials</span> <span class="kn">import</span> <span class="n">SnowflakeCredentials</span>
<span class="kn">from</span> <span class="nn">prefect_snowflake.database</span> <span class="kn">import</span> <span class="n">SnowflakeConnector</span><span class="p">,</span> <span class="n">snowflake_multiquery</span>


<span class="nd">@flow</span>
<span class="k">def</span> <span class="nf">snowflake_multiquery_flow</span><span class="p">():</span>
    <span class="n">snowflake_credentials</span> <span class="o">=</span> <span class="n">SnowflakeCredentials</span><span class="p">(</span>
        <span class="n">account</span><span class="o">=</span><span class="s2">&quot;account&quot;</span><span class="p">,</span>
        <span class="n">user</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
        <span class="n">password</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">snowflake_connector</span> <span class="o">=</span> <span class="n">SnowflakeConnector</span><span class="p">(</span>
        <span class="n">database</span><span class="o">=</span><span class="s2">&quot;database&quot;</span><span class="p">,</span>
        <span class="n">warehouse</span><span class="o">=</span><span class="s2">&quot;warehouse&quot;</span><span class="p">,</span>
        <span class="n">schema</span><span class="o">=</span><span class="s2">&quot;schema&quot;</span><span class="p">,</span>
        <span class="n">credentials</span><span class="o">=</span><span class="n">snowflake_credentials</span>
    <span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">snowflake_multiquery</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;SELECT * FROM table WHERE id=%</span><span class="si">{id_param}</span><span class="s2">s LIMIT 8;&quot;</span><span class="p">,</span> <span class="s2">&quot;SELECT 1,2&quot;</span><span class="p">],</span>
        <span class="n">snowflake_connector</span><span class="p">,</span>
        <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;id_param&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
        <span class="n">as_transaction</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="n">snowflake_multiquery_flow</span><span class="p">()</span>
</code></pre></div></p>

        <details class="quote">
          <summary>Source code in <code>prefect_snowflake/database.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@task</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">snowflake_multiquery</span><span class="p">(</span>
    <span class="n">queries</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">snowflake_connector</span><span class="p">:</span> <span class="n">SnowflakeConnector</span><span class="p">,</span>
    <span class="n">params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cursor_type</span><span class="p">:</span> <span class="n">SnowflakeCursor</span> <span class="o">=</span> <span class="n">SnowflakeCursor</span><span class="p">,</span>
    <span class="n">as_transaction</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">return_transaction_control_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">poll_frequency_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Executes multiple queries against a Snowflake database in a shared session.</span>
<span class="sd">    Allows execution in a transaction.</span>

<span class="sd">    Args:</span>
<span class="sd">        queries: The list of queries to execute against the database.</span>
<span class="sd">        params: The params to replace the placeholders in the query.</span>
<span class="sd">        snowflake_connector: The credentials to use to authenticate.</span>
<span class="sd">        cursor_type: The type of database cursor to use for the query.</span>
<span class="sd">        as_transaction: If True, queries are executed in a transaction.</span>
<span class="sd">        return_transaction_control_results: Determines if the results of queries</span>
<span class="sd">            controlling the transaction (BEGIN/COMMIT) should be returned.</span>
<span class="sd">        poll_frequency_seconds: Number of seconds to wait in between checks for</span>
<span class="sd">            run completion.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of the outputs of `response.fetchall()` for each query.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Query Snowflake table with the ID value parameterized.</span>
<span class="sd">        ```python</span>
<span class="sd">        from prefect import flow</span>
<span class="sd">        from prefect_snowflake.credentials import SnowflakeCredentials</span>
<span class="sd">        from prefect_snowflake.database import SnowflakeConnector, snowflake_multiquery</span>


<span class="sd">        @flow</span>
<span class="sd">        def snowflake_multiquery_flow():</span>
<span class="sd">            snowflake_credentials = SnowflakeCredentials(</span>
<span class="sd">                account=&quot;account&quot;,</span>
<span class="sd">                user=&quot;user&quot;,</span>
<span class="sd">                password=&quot;password&quot;,</span>
<span class="sd">            )</span>
<span class="sd">            snowflake_connector = SnowflakeConnector(</span>
<span class="sd">                database=&quot;database&quot;,</span>
<span class="sd">                warehouse=&quot;warehouse&quot;,</span>
<span class="sd">                schema=&quot;schema&quot;,</span>
<span class="sd">                credentials=snowflake_credentials</span>
<span class="sd">            )</span>
<span class="sd">            result = snowflake_multiquery(</span>
<span class="sd">                [&quot;SELECT * FROM table WHERE id=%{id_param}s LIMIT 8;&quot;, &quot;SELECT 1,2&quot;],</span>
<span class="sd">                snowflake_connector,</span>
<span class="sd">                params={&quot;id_param&quot;: 1},</span>
<span class="sd">                as_transaction=True</span>
<span class="sd">            )</span>
<span class="sd">            return result</span>

<span class="sd">        snowflake_multiquery_flow()</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">snowflake_connector</span><span class="o">.</span><span class="n">get_connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">as_transaction</span><span class="p">:</span>
            <span class="n">queries</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">BEGIN_TRANSACTION_STATEMENT</span><span class="p">)</span>
            <span class="n">queries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">END_TRANSACTION_STATEMENT</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">cursor_type</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">query</span> <span class="ow">in</span> <span class="n">queries</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">execute_async</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
                <span class="n">query_id</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;queryId&quot;</span><span class="p">]</span>
                <span class="k">while</span> <span class="n">connection</span><span class="o">.</span><span class="n">is_still_running</span><span class="p">(</span>
                    <span class="n">connection</span><span class="o">.</span><span class="n">get_query_status_throw_if_error</span><span class="p">(</span><span class="n">query_id</span><span class="p">)</span>
                <span class="p">):</span>
                    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">poll_frequency_seconds</span><span class="p">)</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">get_results_from_sfqid</span><span class="p">(</span><span class="n">query_id</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="c1"># cut off results from BEGIN/COMMIT queries</span>
    <span class="k">if</span> <span class="n">as_transaction</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">return_transaction_control_results</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">results</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="prefect_snowflake.database.snowflake_query" class="doc doc-heading">
<code class="highlight language-python"><span class="n">snowflake_query</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-async"><code>async</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">

      <p>Executes a query against a Snowflake database.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>query</code></td>
        <td><code>str</code></td>
        <td><p>The query to execute against the database.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>params</code></td>
        <td><code>Union[Tuple[Any], Dict[str, Any]]</code></td>
        <td><p>The params to replace the placeholders in the query.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>snowflake_connector</code></td>
        <td><code>SnowflakeConnector</code></td>
        <td><p>The credentials to use to authenticate.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>cursor_type</code></td>
        <td><code>SnowflakeCursor</code></td>
        <td><p>The type of database cursor to use for the query.</p></td>
        <td><code>&lt;class &#39;snowflake.connector.cursor.SnowflakeCursor&#39;&gt;</code></td>
      </tr>
      <tr>
        <td><code>poll_frequency_seconds</code></td>
        <td><code>int</code></td>
        <td><p>Number of seconds to wait in between checks for
run completion.</p></td>
        <td><code>1</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>List[Tuple[Any]]</code></td>
      <td><p>The output of <code>response.fetchall()</code>.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <p>Query Snowflake table with the ID value parameterized.
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">prefect</span> <span class="kn">import</span> <span class="n">flow</span>
<span class="kn">from</span> <span class="nn">prefect_snowflake.credentials</span> <span class="kn">import</span> <span class="n">SnowflakeCredentials</span>
<span class="kn">from</span> <span class="nn">prefect_snowflake.database</span> <span class="kn">import</span> <span class="n">SnowflakeConnector</span><span class="p">,</span> <span class="n">snowflake_query</span>


<span class="nd">@flow</span>
<span class="k">def</span> <span class="nf">snowflake_query_flow</span><span class="p">():</span>
    <span class="n">snowflake_credentials</span> <span class="o">=</span> <span class="n">SnowflakeCredentials</span><span class="p">(</span>
        <span class="n">account</span><span class="o">=</span><span class="s2">&quot;account&quot;</span><span class="p">,</span>
        <span class="n">user</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
        <span class="n">password</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">snowflake_connector</span> <span class="o">=</span> <span class="n">SnowflakeConnector</span><span class="p">(</span>
        <span class="n">database</span><span class="o">=</span><span class="s2">&quot;database&quot;</span><span class="p">,</span>
        <span class="n">warehouse</span><span class="o">=</span><span class="s2">&quot;warehouse&quot;</span><span class="p">,</span>
        <span class="n">schema</span><span class="o">=</span><span class="s2">&quot;schema&quot;</span><span class="p">,</span>
        <span class="n">credentials</span><span class="o">=</span><span class="n">snowflake_credentials</span>
    <span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">snowflake_query</span><span class="p">(</span>
        <span class="s2">&quot;SELECT * FROM table WHERE id=%</span><span class="si">{id_param}</span><span class="s2">s LIMIT 8;&quot;</span><span class="p">,</span>
        <span class="n">snowflake_connector</span><span class="p">,</span>
        <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;id_param&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="n">snowflake_query_flow</span><span class="p">()</span>
</code></pre></div></p>

        <details class="quote">
          <summary>Source code in <code>prefect_snowflake/database.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@task</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">snowflake_query</span><span class="p">(</span>
    <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">snowflake_connector</span><span class="p">:</span> <span class="n">SnowflakeConnector</span><span class="p">,</span>
    <span class="n">params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cursor_type</span><span class="p">:</span> <span class="n">SnowflakeCursor</span> <span class="o">=</span> <span class="n">SnowflakeCursor</span><span class="p">,</span>
    <span class="n">poll_frequency_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Executes a query against a Snowflake database.</span>

<span class="sd">    Args:</span>
<span class="sd">        query: The query to execute against the database.</span>
<span class="sd">        params: The params to replace the placeholders in the query.</span>
<span class="sd">        snowflake_connector: The credentials to use to authenticate.</span>
<span class="sd">        cursor_type: The type of database cursor to use for the query.</span>
<span class="sd">        poll_frequency_seconds: Number of seconds to wait in between checks for</span>
<span class="sd">            run completion.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The output of `response.fetchall()`.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Query Snowflake table with the ID value parameterized.</span>
<span class="sd">        ```python</span>
<span class="sd">        from prefect import flow</span>
<span class="sd">        from prefect_snowflake.credentials import SnowflakeCredentials</span>
<span class="sd">        from prefect_snowflake.database import SnowflakeConnector, snowflake_query</span>


<span class="sd">        @flow</span>
<span class="sd">        def snowflake_query_flow():</span>
<span class="sd">            snowflake_credentials = SnowflakeCredentials(</span>
<span class="sd">                account=&quot;account&quot;,</span>
<span class="sd">                user=&quot;user&quot;,</span>
<span class="sd">                password=&quot;password&quot;,</span>
<span class="sd">            )</span>
<span class="sd">            snowflake_connector = SnowflakeConnector(</span>
<span class="sd">                database=&quot;database&quot;,</span>
<span class="sd">                warehouse=&quot;warehouse&quot;,</span>
<span class="sd">                schema=&quot;schema&quot;,</span>
<span class="sd">                credentials=snowflake_credentials</span>
<span class="sd">            )</span>
<span class="sd">            result = snowflake_query(</span>
<span class="sd">                &quot;SELECT * FROM table WHERE id=%{id_param}s LIMIT 8;&quot;,</span>
<span class="sd">                snowflake_connector,</span>
<span class="sd">                params={&quot;id_param&quot;: 1}</span>
<span class="sd">            )</span>
<span class="sd">            return result</span>

<span class="sd">        snowflake_query_flow()</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># context manager automatically rolls back failed transactions and closes</span>
    <span class="k">with</span> <span class="n">snowflake_connector</span><span class="o">.</span><span class="n">get_connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">cursor_type</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">execute_async</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
            <span class="n">query_id</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;queryId&quot;</span><span class="p">]</span>
            <span class="k">while</span> <span class="n">connection</span><span class="o">.</span><span class="n">is_still_running</span><span class="p">(</span>
                <span class="n">connection</span><span class="o">.</span><span class="n">get_query_status_throw_if_error</span><span class="p">(</span><span class="n">query_id</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">poll_frequency_seconds</span><span class="p">)</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">get_results_from_sfqid</span><span class="p">(</span><span class="n">query_id</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="prefect_snowflake.database.snowflake_query_sync" class="doc doc-heading">
<code class="highlight language-python"><span class="n">snowflake_query_sync</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-async"><code>async</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">

      <p>Executes a query in sync mode against a Snowflake database.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>query</code></td>
        <td><code>str</code></td>
        <td><p>The query to execute against the database.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>params</code></td>
        <td><code>Union[Tuple[Any], Dict[str, Any]]</code></td>
        <td><p>The params to replace the placeholders in the query.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>snowflake_connector</code></td>
        <td><code>SnowflakeConnector</code></td>
        <td><p>The credentials to use to authenticate.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>cursor_type</code></td>
        <td><code>SnowflakeCursor</code></td>
        <td><p>The type of database cursor to use for the query.</p></td>
        <td><code>&lt;class &#39;snowflake.connector.cursor.SnowflakeCursor&#39;&gt;</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>List[Tuple[Any]]</code></td>
      <td><p>The output of <code>response.fetchall()</code>.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <p>Execute a put statement.
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">prefect</span> <span class="kn">import</span> <span class="n">flow</span>
<span class="kn">from</span> <span class="nn">prefect_snowflake.credentials</span> <span class="kn">import</span> <span class="n">SnowflakeCredentials</span>
<span class="kn">from</span> <span class="nn">prefect_snowflake.database</span> <span class="kn">import</span> <span class="n">SnowflakeConnector</span><span class="p">,</span> <span class="n">snowflake_query</span>


<span class="nd">@flow</span>
<span class="k">def</span> <span class="nf">snowflake_query_sync_flow</span><span class="p">():</span>
    <span class="n">snowflake_credentials</span> <span class="o">=</span> <span class="n">SnowflakeCredentials</span><span class="p">(</span>
        <span class="n">account</span><span class="o">=</span><span class="s2">&quot;account&quot;</span><span class="p">,</span>
        <span class="n">user</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
        <span class="n">password</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">snowflake_connector</span> <span class="o">=</span> <span class="n">SnowflakeConnector</span><span class="p">(</span>
        <span class="n">database</span><span class="o">=</span><span class="s2">&quot;database&quot;</span><span class="p">,</span>
        <span class="n">warehouse</span><span class="o">=</span><span class="s2">&quot;warehouse&quot;</span><span class="p">,</span>
        <span class="n">schema</span><span class="o">=</span><span class="s2">&quot;schema&quot;</span><span class="p">,</span>
        <span class="n">credentials</span><span class="o">=</span><span class="n">snowflake_credentials</span>
    <span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">snowflake_query_sync</span><span class="p">(</span>
        <span class="s2">&quot;put file://afile.csv @mystage;&quot;</span><span class="p">,</span>
        <span class="n">snowflake_connector</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="n">snowflake_query_sync_flow</span><span class="p">()</span>
</code></pre></div></p>

        <details class="quote">
          <summary>Source code in <code>prefect_snowflake/database.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@task</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">snowflake_query_sync</span><span class="p">(</span>
    <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">snowflake_connector</span><span class="p">:</span> <span class="n">SnowflakeConnector</span><span class="p">,</span>
    <span class="n">params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cursor_type</span><span class="p">:</span> <span class="n">SnowflakeCursor</span> <span class="o">=</span> <span class="n">SnowflakeCursor</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Executes a query in sync mode against a Snowflake database.</span>

<span class="sd">    Args:</span>
<span class="sd">        query: The query to execute against the database.</span>
<span class="sd">        params: The params to replace the placeholders in the query.</span>
<span class="sd">        snowflake_connector: The credentials to use to authenticate.</span>
<span class="sd">        cursor_type: The type of database cursor to use for the query.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The output of `response.fetchall()`.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Execute a put statement.</span>
<span class="sd">        ```python</span>
<span class="sd">        from prefect import flow</span>
<span class="sd">        from prefect_snowflake.credentials import SnowflakeCredentials</span>
<span class="sd">        from prefect_snowflake.database import SnowflakeConnector, snowflake_query</span>


<span class="sd">        @flow</span>
<span class="sd">        def snowflake_query_sync_flow():</span>
<span class="sd">            snowflake_credentials = SnowflakeCredentials(</span>
<span class="sd">                account=&quot;account&quot;,</span>
<span class="sd">                user=&quot;user&quot;,</span>
<span class="sd">                password=&quot;password&quot;,</span>
<span class="sd">            )</span>
<span class="sd">            snowflake_connector = SnowflakeConnector(</span>
<span class="sd">                database=&quot;database&quot;,</span>
<span class="sd">                warehouse=&quot;warehouse&quot;,</span>
<span class="sd">                schema=&quot;schema&quot;,</span>
<span class="sd">                credentials=snowflake_credentials</span>
<span class="sd">            )</span>
<span class="sd">            result = snowflake_query_sync(</span>
<span class="sd">                &quot;put file://afile.csv @mystage;&quot;,</span>
<span class="sd">                snowflake_connector,</span>
<span class="sd">            )</span>
<span class="sd">            return result</span>

<span class="sd">        snowflake_query_sync_flow()</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># context manager automatically rolls back failed transactions and closes</span>
    <span class="k">with</span> <span class="n">snowflake_connector</span><span class="o">.</span><span class="n">get_connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">cursor_type</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../credentials/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Credentials" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Credentials
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
    
    
  </body>
</html>